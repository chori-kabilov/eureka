# 06 — Architectural & Product Decisions (MVP)

Журнал ключевых решений проекта CRM для учебного центра.

Назначение документа:
- зафиксировать принятые решения;
- предотвратить пересмотр требований “по ходу”;
- служить точкой истины при сомнениях и рефакторинге.

Если решение записано здесь — оно **не обсуждается до релиза MVP**.

---

## 1. Продуктовые решения

### D-01. Цель версии
- **Решение:** делаем только MVP v1.
- **Причина:** цель — рабочий продукт в реальном центре, а не идеальная система.
- **Следствие:** roadmap V2/V3 не рассматривается до релиза.

---

### D-02. Базовая единица системы
- **Решение:** базовая единица — **урок (Lesson)**.
- **Причина:** посещаемость, замены преподавателей и реальный учебный процесс происходят на уровне урока.
- **Следствие:** месяц/курс/пакет — это агрегаты, а не основа логики.

---

### D-03. Долги
- **Решение:** долгов **нет**.
- **Причина:** долги усложняют бизнес-логику, UX и внедрение.
- **Следствие:** в системе нет balance, debt, overdue, partial payment.

---

## 2. Архитектурные решения

### D-04. Тип архитектуры
- **Решение:** монолит.
- **Причина:** MVP, одна команда, быстрый цикл изменений.
- **Следствие:** никакие микросервисы, очереди, распределённые транзакции не используются.

---

### D-05. Архитектурный стиль
- **Решение:** Clean Architecture по проектам:
  - Domain
  - Application
  - Infrastructure
  - WebApi
- **Причина:** понятные границы и контроль зависимости.
- **Следствие:** Domain не знает ни про EF, ни про HTTP.

---

### D-06. Организация кода
- **Решение:** гибрид:
  - по проектам — Clean Architecture;
  - внутри Application — модули + use-cases.
- **Причина:** чистый vertical slice пока непонятен разработчику.
- **Следствие:** структура остаётся понятной и не блокирует развитие.

---

## 3. Технические решения

### D-07. Технологический стек
- **Решение:**
  - .NET 8
  - ASP.NET Core 8
  - EF Core 8
  - PostgreSQL 16
- **Причина:** стабильный, современный и знакомый стек.
- **Следствие:** никаких экспериментов с альтернативными ORM/DB в MVP.

---

### D-08. DTO
- **Решение:** DTO обязательны.
- **Причина:** защита доменной модели и стабильность API.
- **Следствие:** доменные сущности не возвращаются наружу.

---

### D-09. API
- **Решение:** `/api/v1`.
- **Причина:** готовность к изменениям без ломки клиентов.
- **Следствие:** все контроллеры живут в `v1`.

---

### D-10. Репозитории
- **Решение:** Repository pattern **не используется**.
- **Причина:** EF Core уже является репозиторием.
- **Следствие:** Application работает через `IAppDbContext`.

---

### D-11. CQRS / MediatR
- **Решение:** не использовать.
- **Причина:** усложнение без пользы для MVP.
- **Следствие:** use-cases реализуются обычными классами.

---

## 4. Данные и хранение

### D-12. Soft delete
- **Решение:** soft delete через два поля:
  - `IsDeleted`
  - `DeletedAt`
- **Применяется к:** Users, Courses, Groups
- **Не применяется к:** Lessons, AttendanceRecords, Payments
- **Причина:** сохранение истории.
- **Следствие:** глобальные EF-фильтры.

---

### D-13. Исторические данные
- **Решение:** уроки, посещаемость и платежи **не удаляются**.
- **Причина:** это юридически и операционно важные данные.
- **Следствие:** исправления только через статусы/коррекцию.

---

### D-14. Миграции
- **Решение:** только через EF migrations.
- **Причина:** воспроизводимость окружений.
- **Следствие:** никаких “ручных” правок БД.

---

## 5. Безопасность и доступы

### D-15. Роли
- **Решение:** фиксированные роли:
  - Admin
  - Teacher
  - Student
  - Parent
- **Причина:** гибкие роли усложняют MVP.
- **Следствие:** роль задаётся при создании пользователя.

---

### D-16. Аудит
- **Решение:** минимальный аудит (CreatedAt/By, UpdatedAt/By).
- **Причина:** реальная эксплуатация требует понимания “кто и когда”.
- **Следствие:** аудит обязателен в ключевых таблицах.

---

## 6. Эксплуатационные решения

### D-17. Импорт данных
- **Решение:** массовый импорт отсутствует в MVP.
- **Причина:** можно ввести вручную на старте.
- **Следствие:** импорт — только после стабилизации.

---

### D-18. Уведомления
- **Решение:** уведомления не обязательны в MVP.
- **Причина:** бизнес может жить без них.
- **Следствие:** Telegram/Email/SMS — позже.

---

## 7. Правило изменений

### D-19. Изменения требований
- **Решение:** новые идеи не добавляются в MVP.
- **Процесс:** идея → список после релиза → оценка.
- **Причина:** защита от бесконечной разработки.

---

## 8. Статус документа

Версия: **MVP v1 — зафиксировано**

Этот документ является финальной точкой принятия решений до релиза MVP.
