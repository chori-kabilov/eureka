# 08 — Acceptance Tests (MVP Checklist)

Чеклист приёмки MVP CRM учебного центра.
MVP считается готовым, когда все пункты в этом документе выполнены.

Правила:
- Если пункт не проходит — MVP НЕ готов.
- Если появилась новая идея — она не добавляется в чеклист до релиза.
- Долгов нет. Soft delete есть только там, где зафиксировано.

---

## 0) Базовые условия

- [ ] Приложение запускается без ошибок
- [ ] API отвечает на базовые запросы
- [ ] Миграции применяются на чистой базе
- [ ] В БД создаются все таблицы из `07-data-model.md`
- [ ] Включены глобальные фильтры soft delete для Users/Courses/Groups
- [ ] В логах нет секретов (пароли, токены, хеши)

---

## 1) Авторизация и роли

### 1.1 Логин
- [ ] Админ может войти по логину/паролю
- [ ] Неверный пароль возвращает понятную ошибку
- [ ] Пользователь со статусом Inactive не может войти
- [ ] Soft-deleted пользователь не может войти

### 1.2 Доступы
- [ ] Студент не может создавать/редактировать курсы
- [ ] Студент не может создавать/редактировать группы
- [ ] Преподаватель не может фиксировать оплаты
- [ ] Преподаватель не может редактировать курсы
- [ ] Админ имеет полный доступ

---

## 2) Пользователи (Students/Teachers/Parents)

### 2.1 Создание и редактирование
- [ ] Админ может создать студента
- [ ] Админ может создать преподавателя
- [ ] Админ может создать родителя
- [ ] Админ может редактировать имя/телефон/email пользователя
- [ ] Телефон не может быть пустым
- [ ] Телефон уникален среди НЕ удалённых пользователей (если принято)

### 2.2 Soft delete пользователей
- [ ] Админ может “удалить” пользователя (soft delete)
- [ ] Soft-deleted пользователь пропадает из списков по умолчанию
- [ ] Исторические данные пользователя не ломаются (уроки/посещаемость/платежи видны в истории)
- [ ] Админ может восстановить пользователя (IsDeleted=false, DeletedAt=null)

---

## 3) Курсы

### 3.1 Создание курса
- [ ] Админ может создать курс
- [ ] Поля курса сохраняются корректно:
  - [ ] student_payment_type
  - [ ] absence_policy (Burn)
  - [ ] teacher_payment_type
- [ ] Курс виден в списке активных курсов

### 3.2 Архивация/удаление курса
- [ ] Админ может архивировать курс (status=Archived)
- [ ] Архивный курс не предлагается для создания новых групп (если принято)
- [ ] Админ может soft delete курса (если включено)
- [ ] Soft-deleted курс не виден в списках по умолчанию
- [ ] История групп/уроков по курсу не ломается

---

## 4) Группы

### 4.1 Создание группы
- [ ] Админ может создать группу, указав:
  - [ ] курс
  - [ ] преподавателя
  - [ ] даты (start_date, end_date опционально)
  - [ ] расписание (дни недели + время)
  - [ ] capacity
- [ ] Нельзя создать группу с capacity <= 0
- [ ] Нельзя создать группу с time_end <= time_start

### 4.2 Управление статусом группы
- [ ] Админ может закрыть группу (status=Completed)
- [ ] Закрытая группа не генерирует новые уроки

### 4.3 Soft delete группы
- [ ] Админ может soft delete группы
- [ ] Soft-deleted группа пропадает из списков по умолчанию
- [ ] История уроков группы сохраняется

---

## 5) Состав группы (GroupStudents)

### 5.1 Добавление студента
- [ ] Админ может добавить студента в группу
- [ ] Нельзя добавить одного студента в ту же группу дважды
- [ ] Нельзя добавить студента, если группа заполнена (capacity)
- [ ] Soft-deleted студент не может быть добавлен в группу

### 5.2 Удаление студента из группы
- [ ] Админ может удалить студента из группы (удаляется связь)
- [ ] Удаление связи не удаляет студента

---

## 6) Уроки и календарь

### 6.1 Генерация уроков
- [ ] Система может сгенерировать уроки для группы на период
- [ ] Уроки создаются со статусом Planned
- [ ] Уроки создаются по расписанию группы (дни недели + время)
- [ ] Уроки не создаются для Completed/Deleted группы

### 6.2 Просмотр календаря
- [ ] Админ может посмотреть уроки за выбранную дату
- [ ] Преподаватель видит только свои уроки
- [ ] Студент видит только свои уроки (по группам)

### 6.3 Перенос урока
- [ ] Админ может перенести дату/время урока
- [ ] После переноса урок корректно отображается в календаре

### 6.4 Отмена урока
- [ ] Админ может отменить урок (status=Cancelled)
- [ ] Отменённый урок не доступен для отметки посещаемости
- [ ] Отменённый урок отображается в календаре как отменённый

---

## 7) Замена преподавателя

- [ ] Админ может назначить замену преподавателя на конкретный урок
- [ ] Замена не меняет преподавателя группы
- [ ] После замены урок отображается с новым преподавателем
- [ ] Замена невозможна для Completed урока (если принято)
- [ ] Замена невозможна для Cancelled урока

---

## 8) Посещаемость

### 8.1 Отметка посещаемости
- [ ] Преподаватель может открыть урок Planned
- [ ] Преподаватель может отметить каждого студента: Present/Absent
- [ ] После отметки урок становится Completed
- [ ] Повторная отметка после Completed запрещена (MVP)

### 8.2 Ограничения
- [ ] Нельзя отметить посещаемость на Cancelled уроке
- [ ] Студент не может менять посещаемость

### 8.3 Просмотр посещаемости
- [ ] Админ видит посещаемость по уроку
- [ ] Студент/родитель видят посещаемость по своим урокам

---

## 9) Платежи (без долгов)

### 9.1 Создание платежа
- [ ] Админ может добавить платёж
- [ ] Платёж имеет:
  - [ ] payer_type + payer_id
  - [ ] target_type + target_ref
  - [ ] amount > 0
  - [ ] paid_at
- [ ] Платёж появляется в списке платежей

### 9.2 Нет долгов — проверка
- [ ] В системе нет сущности/поля "Debt" или "Balance"
- [ ] Нет статусов "ожидает оплату", "частично оплачено"
- [ ] Невозможна операция “начислить долг”
- [ ] Отсутствие оплаты не блокирует действия автоматически (MVP)

### 9.3 Отчёт по платежам
- [ ] Админ может получить отчёт по платежам за период
- [ ] Отчёт совпадает с суммой платежей в БД за этот период

---

## 10) Логи и ошибки

- [ ] Все ошибки обрабатываются единым middleware
- [ ] Клиент получает понятный ответ об ошибке (без stack trace)
- [ ] В логах есть correlation id (или request id)
- [ ] Логи пишутся структурировано (минимум: уровень, сообщение, request id)
- [ ] Ошибка в одном сценарии не ломает остальные

---

## 11) Производительность (реалистичный минимум)

- [ ] Страница “уроки на дату” работает быстро при 10k уроках
- [ ] Страница “посещаемость урока” работает быстро при 30 студентах
- [ ] Отчёт по платежам за месяц работает быстро при 10k платежах

---

## 12) Готовность к внедрению

- [ ] Админ может выполнить базовый день работы без таблиц:
  - [ ] добавить студента
  - [ ] записать в группу
  - [ ] проверить расписание
  - [ ] зафиксировать оплату
- [ ] Преподаватель может:
  - [ ] увидеть свой урок
  - [ ] отметить посещаемость
- [ ] Студент/родитель могут:
  - [ ] увидеть расписание
  - [ ] увидеть посещаемость

---

## 13) Итог

MVP v1 готов к релизу, когда:
- все пункты отмечены,
- нет “почти работает”,
- история не ломается,
- учебный центр может реально пользоваться системой.